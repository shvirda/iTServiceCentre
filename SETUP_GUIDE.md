# PromoService V0001 - Руководство по установке и первому запуску

## Статус реализации (Первый этап)

✓ **Завершено:**
- Структура проекта создана
- Архитектура приложения спроектирована
- Backend API (Flask) реализован
- Модели БД (7 таблиц) созданы
- Система аутентификации с JWT реализована
- Тесты для API написаны
- API клиент для frontend создан
- Первый модуль UI (управление БД) создан

## Структура проекта

```
promoserviceV0001/
├── backend/              # REST API (Flask)
│   ├── auth.py          # Авторизация, JWT токены
│   ├── app.py           # Главное приложение
│   └── api/             # API endpoints (заглушки)
├── frontend/            # PyQt6 интерфейс
│   ├── modules/         # 10 модулей приложения
│   │   └── module1_db.py  # Управление БД (реализован)
│   ├── ui/              # UI компоненты
│   └── utils/
│       └── api_client.py  # HTTP клиент для API
├── database/            # Работа с БД
│   ├── models.py        # SQLAlchemy модели
│   └── db_manager.py    # Менеджер БД
├── tests/               # Тесты
│   └── test_api.py      # Тесты API
├── config.py            # Конфигурация
├── run_backend.py       # Запуск backend сервера
└── requirements.txt     # Зависимости
```

## Установка

### 1. Установить зависимости

```bash
cd K:\PROJECTs-FACTORY\serviseCentr\promoserviceV0001
pip install -r requirements.txt
```

### 2. Запустить Backend API сервер

```bash
python run_backend.py
```

На консоль будет выведено:
```
============================================================
PromoService V0001 - Backend Server
============================================================

Инициализация БД...
✓ Администратор создан (username: admin, password: admin123)
  ⚠ Обязательно измените пароль после первого входа!
✓ База данных инициализирована

============================================================
API Сервер запущен:
  Host: 127.0.0.1
  Port: 5000
  URL: http://127.0.0.1:5000
============================================================
```

## Запуск тестов

```bash
python -m pytest tests/test_api.py -v
```

## Тестирование API

### 1. Проверка здоровья API

```bash
curl http://127.0.0.1:5000/api/health
```

### 2. Вход администратора

```bash
curl -X POST http://127.0.0.1:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'
```

Ответ:
```json
{
  "message": "Вход успешен",
  "token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "user": {
    "id": 1,
    "username": "admin",
    "role": "director"
  }
}
```

### 3. Регистрация нового пользователя

```bash
curl -X POST http://127.0.0.1:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "role": "employee"
  }'
```

## База данных

### Таблицы в БД:
1. **users** - Пользователи системы с JWT токенами
2. **employees** - Сотрудники сервиса с уровнями доступа
3. **clients** - Клиенты сервиса
4. **equipment** - Техника и оборудование на ремонт
5. **warehouse** - Товары на складе (прход/расход/продажа)
6. **services** - Конфигурация сервисов (Telegram, SMS, Email)
7. **operations_log** - История всех операций в системе

### Файл БД:
```
promoservice_db.sqlite3 (создается автоматически в корне проекта)
```

## Уровни доступа

- **director (4)** - Полный доступ, логирование, управление доступом
- **manager (3)** - Управление клиентами, техникой, товаром
- **employee (2)** - Просмотр и добавление данных
- **warehouse (1)** - Управление складом

## Следующие этапы разработки

### Этап 2 - Frontend
- [ ] Реализовать auth_window.py (окно логина)
- [ ] Реализовать main_window.py (главное окно с вкладками)
- [ ] Реализовать оставшиеся 9 модулей
- [ ] Интеграция с API клиентом

### Этап 3 - API Endpoints
- [ ] Реализовать CRUD endpoints для клиентов
- [ ] Реализовать CRUD endpoints для техники
- [ ] Реализовать CRUD endpoints для склада
- [ ] Реализовать CRUD endpoints для сотрудников
- [ ] Реализовать endpoints для логирования

### Этап 4 - Сервисы
- [ ] Интеграция Telegram бота
- [ ] Интеграция SMS рассылок
- [ ] Email уведомления
- [ ] Webhook поддержка

### Этап 5 - Продвинутые функции
- [ ] Локальная сетевая синхронизация
- [ ] Удаленный сервер (PostgreSQL)
- [ ] Резервное копирование
- [ ] Поиск и фильтрация (полнотекстовый поиск)

## Важные замечания

### Безопасность
⚠️ **Обязательно после первого запуска:**
1. Измените пароль администратора
2. Создайте пользователей для сотрудников
3. Установите правильные уровни доступа
4. Измените `JWT_SECRET_KEY` в config.py на боевом сервере

### Разработка
- При добавлении новых таблиц обновляйте `database/models.py`
- При добавлении новых API endpoints обновляйте `backend/app.py`
- При добавлении новых модулей frontend следуйте шаблону в `module1_db.py`

## Помощь

### Частые ошибки

**Ошибка: "Не удается подключиться к 127.0.0.1:5000"**
- Убедитесь, что backend сервер запущен (`python run_backend.py`)
- Проверьте, не занят ли порт 5000

**Ошибка: "No module named 'flask'"**
- Установите зависимости: `pip install -r requirements.txt`

**Ошибка: "sqlite3.OperationalError: database is locked"**
- Закройте все остальные подключения к БД
- Перезагрузите backend сервер

## Контакты и поддержка

Для вопросов, ошибок и предложений обращайтесь к разработчику проекта.

---

**Версия**: 0.0.1 (Alpha)  
**Дата создания**: 2025-12-29  
**Статус**: В разработке  
**Автор**: PromoService Development Team
